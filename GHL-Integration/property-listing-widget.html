<!-- 
  GOHIGHLEVEL PROPERTY LISTING WIDGET
  Paste this into a Custom Code element in GHL
  This displays all properties from your Airtable base
-->

<style>
  .property-listings-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }

  .filters-section {
    background: #f9fafb;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 30px;
  }

  .filters-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 15px;
  }

  .filter-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 5px;
    color: #374151;
  }

  .filter-group select,
  .filter-group input {
    width: 100%;
    padding: 10px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 14px;
  }

  .filter-btn {
    background: #2563eb;
    color: white;
    padding: 10px 25px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.3s;
  }

  .filter-btn:hover {
    background: #1e40af;
  }

  .properties-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 25px;
    margin-top: 30px;
  }

  .property-card {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s, box-shadow 0.3s;
    cursor: pointer;
  }

  .property-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 15px rgba(0, 0, 0, 0.15);
  }

  .property-image {
    width: 100%;
    height: 220px;
    object-fit: cover;
    background: #e5e7eb;
  }

  .property-content {
    padding: 20px;
  }

  .property-title {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 8px;
    color: #1f2937;
  }

  .property-location {
    color: #6b7280;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .property-features {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
    flex-wrap: wrap;
    font-size: 14px;
    color: #6b7280;
  }

  .property-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 15px;
    border-top: 1px solid #e5e7eb;
  }

  .property-price {
    font-size: 24px;
    font-weight: 700;
    color: #2563eb;
  }

  .property-status {
    padding: 5px 12px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
  }

  .status-available { background: #d1fae5; color: #065f46; }
  .status-sold { background: #fee2e2; color: #991b1b; }
  .status-pending { background: #fef3c7; color: #92400e; }

  .loading {
    text-align: center;
    padding: 40px;
    font-size: 18px;
    color: #6b7280;
  }

  .error-message {
    background: #fee2e2;
    color: #991b1b;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
  }

  .no-results {
    text-align: center;
    padding: 60px 20px;
    color: #6b7280;
  }

  @media (max-width: 768px) {
    .properties-grid {
      grid-template-columns: 1fr;
    }
    .filters-grid {
      grid-template-columns: 1fr;
    }
  }
</style>

<div class="property-listings-container">
  <!-- Filters -->
  <div class="filters-section">
    <h2 style="margin-bottom: 20px;">Search Properties</h2>
    <div class="filters-grid">
      <div class="filter-group">
        <label>Property Type</label>
        <select id="propertyTypeFilter">
          <option value="">All Types</option>
          <option value="House">House</option>
          <option value="Apartment">Apartment</option>
          <option value="Condo">Condo</option>
          <option value="Townhouse">Townhouse</option>
          <option value="Villa">Villa</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Min Price</label>
        <input type="number" id="minPriceFilter" placeholder="$0">
      </div>
      <div class="filter-group">
        <label>Max Price</label>
        <input type="number" id="maxPriceFilter" placeholder="Any">
      </div>
      <div class="filter-group">
        <label>Status</label>
        <select id="statusFilter">
          <option value="">All Status</option>
          <option value="Available">Available</option>
          <option value="Sold">Sold</option>
          <option value="Pending">Pending</option>
        </select>
      </div>
    </div>
    <button class="filter-btn" onclick="applyFilters()">Apply Filters</button>
  </div>

  <!-- Loading -->
  <div id="loading" class="loading">Loading properties...</div>

  <!-- Error -->
  <div id="error" class="error-message" style="display: none;"></div>

  <!-- No Results -->
  <div id="noResults" class="no-results" style="display: none;">
    <h3>No Properties Found</h3>
    <p>Try adjusting your filters or check back later.</p>
  </div>

  <!-- Properties Grid -->
  <div id="propertiesGrid" class="properties-grid"></div>
</div>

<script>
  // ‚ö†Ô∏è IMPORTANT: Replace these with your actual Airtable credentials
  const AIRTABLE_CONFIG = {
    apiKey: 'YOUR_AIRTABLE_API_TOKEN',
    baseId: 'YOUR_BASE_ID',
    tableName: 'Properties'
  };

  let allProperties = [];

  // Load properties on page load
  document.addEventListener('DOMContentLoaded', loadProperties);

  async function loadProperties() {
    try {
      showLoading();
      
      const response = await fetch(
        `https://api.airtable.com/v0/${AIRTABLE_CONFIG.baseId}/${AIRTABLE_CONFIG.tableName}`,
        {
          headers: {
            'Authorization': `Bearer ${AIRTABLE_CONFIG.apiKey}`
          }
        }
      );

      if (!response.ok) {
        throw new Error('Failed to load properties');
      }

      const data = await response.json();
      allProperties = data.records.map(record => ({
        id: record.id,
        ...record.fields
      }));

      hideLoading();
      displayProperties(allProperties);

    } catch (error) {
      console.error('Error:', error);
      hideLoading();
      showError('Failed to load properties. Please try again later.');
    }
  }

  function displayProperties(properties) {
    const grid = document.getElementById('propertiesGrid');
    
    if (properties.length === 0) {
      grid.innerHTML = '';
      document.getElementById('noResults').style.display = 'block';
      return;
    }

    document.getElementById('noResults').style.display = 'none';
    
    grid.innerHTML = properties.map(property => `
      <div class="property-card" onclick="viewProperty('${property.id}')">
        <img src="${property.ImageURL || 'https://via.placeholder.com/400x300/e5e7eb/6b7280?text=No+Image'}" 
             alt="${property.Title || 'Property'}" 
             class="property-image"
             onerror="this.src='https://via.placeholder.com/400x300/e5e7eb/6b7280?text=No+Image'">
        <div class="property-content">
          <div class="property-title">${property.Title || 'Untitled Property'}</div>
          <div class="property-location">
            üìç ${property.Location || 'Location not specified'}
          </div>
          <div class="property-features">
            ${property.Bedrooms ? `üõèÔ∏è ${property.Bedrooms} Beds` : ''}
            ${property.Bathrooms ? `üõÅ ${property.Bathrooms} Baths` : ''}
            ${property.SquareFeet ? `üìê ${formatNumber(property.SquareFeet)} sqft` : ''}
          </div>
          <div class="property-footer">
            <div class="property-price">${formatPrice(property.Price)}</div>
            ${property.Status ? `<div class="property-status status-${(property.Status || '').toLowerCase()}">${property.Status}</div>` : ''}
          </div>
        </div>
      </div>
    `).join('');
  }

  function applyFilters() {
    const typeFilter = document.getElementById('propertyTypeFilter').value;
    const minPrice = parseFloat(document.getElementById('minPriceFilter').value) || 0;
    const maxPrice = parseFloat(document.getElementById('maxPriceFilter').value) || Infinity;
    const statusFilter = document.getElementById('statusFilter').value;

    const filtered = allProperties.filter(property => {
      const matchesType = !typeFilter || property.PropertyType === typeFilter;
      const matchesMinPrice = !property.Price || property.Price >= minPrice;
      const matchesMaxPrice = !property.Price || property.Price <= maxPrice;
      const matchesStatus = !statusFilter || property.Status === statusFilter;

      return matchesType && matchesMinPrice && matchesMaxPrice && matchesStatus;
    });

    displayProperties(filtered);
  }

  function viewProperty(id) {
    // Redirect to property details page (you'll need to create this in GHL)
    // Or open a modal with property details
    const property = allProperties.find(p => p.id === id);
    if (property) {
      alert(`Property: ${property.Title}\nPrice: ${formatPrice(property.Price)}\nLocation: ${property.Location}`);
      // Replace with: window.location.href = '/property-details?id=' + id;
    }
  }

  function formatPrice(price) {
    if (!price) return 'Price not available';
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 0
    }).format(price);
  }

  function formatNumber(num) {
    if (!num) return '0';
    return new Intl.NumberFormat('en-US').format(num);
  }

  function showLoading() {
    document.getElementById('loading').style.display = 'block';
    document.getElementById('propertiesGrid').style.display = 'none';
    document.getElementById('error').style.display = 'none';
  }

  function hideLoading() {
    document.getElementById('loading').style.display = 'none';
    document.getElementById('propertiesGrid').style.display = 'grid';
  }

  function showError(message) {
    const errorEl = document.getElementById('error');
    errorEl.textContent = message;
    errorEl.style.display = 'block';
    document.getElementById('propertiesGrid').style.display = 'none';
  }
</script>
